# tmux plugin manager
# install: prefix + I
set-option -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set-option -g @plugin 'nhdaly/tmux-better-mouse-mode'
set-option -g @plugin 'tmux-plugins/tmux-resurrect'
set-option -g @plugin 'tmux-plugins/tmux-continuum'

set-option -g default-terminal screen-256color
set-option -s escape-time 0
set-option -g focus-events on
set-option -g status-keys vi
set-option -g history-limit 50000
set-option -g base-index 0
set-window-option -g pane-base-index 0
set-option -g @continuum-restore 'on'

# ==== Keymaps ====
set-option -g mouse on
unbind-key -T copy-mode MouseDragEnd1Pane
unbind-key -T copy-mode-vi MouseDragEnd1Pane
# コピーしてもコピーモードを抜けない
bind-key -T copy-mode-vi Enter send -X copy-selection
set-option -g @scroll-speed-num-lines-per-scroll 1
set-option -g @scroll-down-exit-copy-mode "off"
set-option -g @emulate-scroll-for-no-mouse-alternate-buffer "on"

set-option -g prefix C-q
bind-key -T prefix C-q send-prefix
bind-key -T prefix r source-file ~/.tmux.conf \; display "Reloaded .tmux.conf"

# Shift + arrow key: paneの移動
bind-key -T root S-Up select-pane -U
bind-key -T root S-Down select-pane -D
bind-key -T root S-Left select-pane -L
bind-key -T root S-Right select-pane -R

# prefix + arrow key: windowの切り替え
bind-key -T prefix left previous-window
bind-key -T prefix right next-window

# prefix + -^: pane作成
bind-key -T prefix ^ split-window -h
bind-key -T prefix - split-window -v

# toggleでsyncモードへ
bind-key -T prefix ] setw synchronize-panes

# prefix -> space: Popupを起動
bind-key -T prefix Space popup -xC -yC -w70% -h70% -E 'tmux a -t Popup || tmux new -s Popup'

# copy modeをvi風に
set-window-option -g mode-keys vi

# ステータスバー
set -g status-position top
set -g status-justify right
set -g status-left-length 170
set -g status-right-length 10
set -g status-bg "colour000"
set -g status-fg "colour255"
set -g status-interval 1

# ステータスバーのフォーマット
set-option -g status-left "#[fg=colour000,bg=colour218] Session: #S #[fg=colour218,bg=default]#[default] ###P #T #{prefix_highlight}"
set-option -g status-right ""

# window タブ一覧のフォーマット
setw -g window-status-format " #I: #W "
setw -g window-status-current-format "#[fg=colour255,bg=colour27,bold] #I: #W #[default]"

# paneボーダーのフォーマット
set -g pane-border-format "#P #T #{pane_current_command}) "
set -g pane-border-style fg="default",bg="default"
set -g pane-active-border-style fg="colour013",bg="default"

# pane1枚のときはボーダーを非表示
set-hook -g window-linked 'set-option -w pane-border-status off'
set-hook -g window-layout-changed 'set-window -F pane-border-status "#{?#{==:#{window_panes},1},off,top}"'

set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_copy_mode_attr 'fg=colour000,bg=orange'
set -g @prefix_highlight_copy_prompt 'Copy (Space:通常選択 / v:矩形選択 / V:行選択 / Enter:確定 / q:終了)'
set -g @prefix_highlight_show_sync_mode 'on'
set -g @prefix_highlight_sync_prompt 'Sync'
set -g @prefix_highlight_sync_mode_attr 'fg=default,bg=green'

# (keep this line at the very bottom of tmux.conf)
run '/usr/local/opt/tpm/share/tpm/tpm'
